## 4. ビジネスプロセスのモデリング(第4章)
業務で起こる出来事を**ファクト**として定義し、**粒度（1行の意味）**と**測る数値**を確定する工程。

### 作り方（BEAM* 手順）
1. **イベントごとに数値指標を定義する**  
   例：口座開設は、口座数を指標とする。残高照会は、金額ではなく何回照会したかの件数を指標とする。
2. **関連ディメンションをすべて含める**  
   顧客・口座・日付・チャネル・ATM種別 などの外部キーを持たせる。
   → **適合ディメンション**は複数ファクトで同一定義を共有する
3. **粒度（グレイン）を明確に**  
   1行＝1イベント発生単位にする（分析しやすくするように）

💡**ポイント**
- ファクトは、何を測定するか定義したもの。単なる数値ではなく分析で使える測定値。
- 粒度を明確にすることで、集計の一貫性が保たれる  
- すべての外部キーは必ず定義し、ディメンションとの結合を可能にする 
- **適合ディメンションを先に設計・合意**しておくと、後続のファクト追加が容易  

---

### 適合ディメンション（Conformed Dimensions）について
- **定義**：複数のビジネスプロセス（ファクト）間で、**同一の意味・粒度・コード体系・SCD方針**を保って共有されるディメンション。  
- **本ケースの適合ディメンション**：
  - 顧客、口座、日付、チャネル … *全ファクトで共通利用*
  - ATM種別/地域 … *現金取引（入金・出金）で共通利用*
- **適合ディメンション（Conformed Dimension）の条件**
  - **意味が同じ**  
    - 例えば、「VIP顧客」の定義が部署や分析ごとにバラバラではない
  - **粒度が同じ**  
    - 日付なら日単位、顧客なら個人単位など、一貫したレベル
  - **コード体系が同じ**  
    - 顧客種別コードが A/B/C と決まっていて全体で共通
  - **履歴管理（SCD方針）が同じ**  
    - タイプ2の履歴管理を行うなら全ファクトで同じ管理方法を使う
- 💡**ポイント**
  - Conformを「適合」と訳さず「一致」と考える
  - 一致しているディメンションと思えば簡単



---

### 口座開設ファクト
- 開設イベントID（主キー）
- 顧客ID（適合ディメンション）
- 口座ID（適合ディメンション）
- 日付ID（適合ディメンション）
- チャネルID（適合ディメンション）
- 口座数

### 入金ファクト
- 入金イベントID（主キー）
- 顧客ID（適合ディメンション）
- 口座ID（適合ディメンション）
- 日付ID（適合ディメンション）
- チャネルID（適合ディメンション）
- ATM種別ID（適合ディメンション *現金取引系で共通*）
- 金額

### 出金ファクト
- 出金イベントID（主キー）
- 顧客ID（適合ディメンション）
- 口座ID（適合ディメンション）
- 日付ID（適合ディメンション）
- チャネルID（適合ディメンション）
- ATM種別ID（適合ディメンション *現金取引系で共通*）
- 金額

### 送金ファクト
- 送金イベントID（主キー）
- 顧客ID（適合ディメンション）
- 口座ID（適合ディメンション）
- 日付ID（適合ディメンション）
- チャネルID（適合ディメンション）
- 金額

### 残高照会ファクト
- 照会イベントID（主キー）
- 顧客ID（適合ディメンション）
- 口座ID（適合ディメンション）
- 日付ID（適合ディメンション）
- チャネルID（適合ディメンション）
- 件数


## 粒度（Grain）
> - 口座開設F：1行＝1口座開設イベント
> - 入金F：1行＝1入金トランザクション
> - 出金F：1行＝1出金トランザクション
> - 送金F：1行＝1送金トランザクション
> - 残高照会F：1行＝1照会操作


## 1) 適合ディメンション一覧（Facts × Dimensions）
| ファクト \ ディメンション | 顧客ID | 口座ID | 日付ID | チャネルID | ATM種別ID |
|---|:--:|:--:|:--:|:--:|:--:|
| 口座開設ファクト | ✔ | ✔ | ✔ | ✔ |  |
| 入金ファクト     | ✔ | ✔ | ✔ | ✔ | ✔ |
| 出金ファクト     | ✔ | ✔ | ✔ | ✔ | ✔ |
| 送金ファクト     | ✔ | ✔ | ✔ | ✔ |  |
| 残高照会ファクト | ✔ | ✔ | ✔ | ✔ |  |


## 2) ディメンション辞書（Conformed Dictionary）

### 3.1 顧客ディメンション（顧客ID）
- **粒度**：個人（1レコード＝1顧客のある期間の属性）  
- **主キー**：顧客ID（実装例：顧客SK）  
- **主属性例**：氏名、性別、生年月日、住所、顧客ステータス  
- **SCD方針**：Type2（住所・ステータスは `有効開始/有効終了/現行` で履歴管理）  
- **用語/コード**：  
  - 顧客ステータス：`PERSONAL` / `VIP`（社内定義に準拠）  
- **Unknown/N.A.**：0 / -1

### 3.2 口座ディメンション（口座ID）
- **粒度**：口座（1レコード＝1口座のある期間の属性）  
- **主キー**：口座ID（実装例：口座SK）  
- **主属性例**：口座種別、開設日、通貨、利用状況  
- **SCD方針**：Type2（利用状況など可変属性）  
- **用語/コード**：  
  - 口座種別：`ORD`=普通、`SAV`=貯蓄  
  - 利用状況：`ACTIVE` / `DORMANT` / `CLOSED`  
- **Unknown/N.A.**：0 / -1

### 3.3 日付ディメンション（日付ID）
- **粒度**：日（YYYY-MM-DD）  
- **主キー**：日付ID（=DATE）  
- **主属性例**：年、四半期、月、日、曜日、営業日フラグ（任意）  
- **SCD方針**：なし（静的）  
- **Unknown/N.A.**：—（基本不要）

### 3.4 チャネルディメンション（チャネルID）
- **粒度**：チャネルコード（アプリ/連携の識別）  
- **主キー**：チャネルID（実装例：チャネルSK）  
- **主属性例**：チャネル種別（APP/API）、プラットフォーム（iOS/Android）、アプリバージョン（任意）  
- **SCD方針**：Type1（通常は最新上書き）  
- **用語/コード**：  
  - チャネル種別：`APP` / `API`  
  - プラットフォーム：`iOS` / `Android`  
- **Unknown/N.A.**：0 / -1

### 3.5 ATM種別/地域ディメンション（ATM種別ID）
- **粒度**：ATM施設（提携ATM×設置地点）  
- **主キー**：ATM種別ID（実装例：ATM種別SK）  
- **主属性例**：提携ATM名称（例：セブン銀行）、都道府県、市区町村  
- **SCD方針**：Type2（設置地域の変更などに対応）  
- **Unknown/N.A.**：0 / -1

---